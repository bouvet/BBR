<!DOCTYPE html>
<html>
<head>
    <style>
        #map_canvas {
            width: 300px;
            height: 800px;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/signalr/jquery.signalr-2.1.0.min.js"></script>
    <script src="http://localhost:2014/signalr/hubs"></script>

    
    <script>
        var map;
        function initialize() {
            var mapCanvas = document.getElementById('map_canvas');
            var mapOptions = {
                center: new google.maps.LatLng(59.676403, 10.606424),
                zoom: 16,
                mapTypeId: google.maps.MapTypeId.SATELLITE
            }
             map = new google.maps.Map(mapCanvas, mapOptions)
         
        }
        google.maps.event.addDomListener(window, 'load', initialize);
        var lag = {};
        lag.Lag = [];
        $(document).ready(function () {
            $.getJSON("http://localhost:2014/api/game/pif/getAll", function (data) {
                $.each(data, function (key, val) {
                    lag[val.lagId] = createMarker(val.latitude,val.longitude,val.lagId);
                });
            });           
        });


        function createMarker(latitude,longitude,lagid)
        {
            return new google.maps.Marker({
                position: new google.maps.LatLng(latitude, longitude),
                map: map,
                icon: 'http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=' + lagid + '|FE6256|000000'
            });
        }
        var infectedZone;
        function redZone(lat, long, size) {
            var options = {
                strokeColor: '#FF0000',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: '#FF0000',
                fillOpacity: 0.35,
                map: map,
                center:  new google.maps.LatLng(lat,long),
                radius: Math.sqrt(size) * 100
            };
            // Add the circle for this city to the map.
            infectedZone = new google.maps.Circle(options);
        }
        redZone(0,0,2);
    </script>
    <script type="text/javascript">
    $(function () {
        //Set the hubs URL for the connection
        $.connection.hub.url = "http://localhost:2014/signalr";

        // Declare a proxy to reference the hub.
        var hub = $.connection.gameHub;
        hub.client.setRedZone = function (zone) {
            if (zone.latitude == 0 && zone.longitude == 0) {
                infectedZone.setMap(null);
            } else {
                infectedZone.setMap(map);
                var newPosition = new google.maps.LatLng(zone.latitude, zone.longitude);
               infectedZone.setCenter(newPosition);
            }
            //redZone(zone.latitude, zone.longitude, 3);
            //infectedZone.setMap(null);
            //infectedZone.setMap(map);
        };
        // Create a function that the hub can call to broadcast messages.
        hub.client.nyPifPosisjon = function (msg) {
            if (lag[msg.LagId] === undefined) {
                
               
                lag[msg.LagId] = createMarker(msg.Latitude, msg.Longitude, msg.LagId);
            } else
            {
                
                lag[msg.LagId].setPosition(new google.maps.LatLng(msg.Latitude, msg.Longitude));
            }
        };
        // Start the connection.
        $.connection.hub.start({ jsonp: true });//
    });
    </script>




</head>
<body>
   
    <div id="map_canvas"></div>
</body>
</html>